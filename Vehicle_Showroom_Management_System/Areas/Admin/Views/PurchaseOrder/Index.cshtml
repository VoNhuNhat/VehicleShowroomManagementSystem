@model IEnumerable<Vehicle_Showroom_Management_System.Areas.Admin.Data.PurchaseOrder>


@{
    ViewBag.Title = "UserInformation";
    Layout = "~/Areas/Admin/Views/Shared/Index.cshtml";
}

<div class="container">
    <h2 style="text-align: center"><b>List of Purchase Orders</b></h2>
    <br />
    <p>
        <a href="/Admin/PurchaseOrder/Create" class="btn btn-primary"><b>Add new Purchase Order</b></a>
        <input style="float: right" class="form-control col-md-4" name="searchPurchaseOrder" id="searchPurchaseOrder" type="text" placeholder="Search Purchase Order ID..." aria-label="Search" aria-describedby="basic-addon2" />
    </p>
    <table class="table table-bordered" id="tablePurchaseOrder">
        <tr>
            <th>
            </th>
            <th>
                <b>Purchase Order Id</b>
            </th>
            <th>
                <b>Quantity Imported Car</b>
            </th>
            <th>
                <b>Car Model Name</b>
            </th>
            <th>
                <b>Order Date</b>
            </th>
            <th>
                <b>@Html.DisplayNameFor(model => model.Status)</b>
            </th>
            <th></th>
        </tr>
        <tbody>
        </tbody>
    </table>
    <div class="pagination" id="pagination" style="float: right">
    </div>
    <div class="pagination" id="paginationSearchMutiplePages" style="float: right">
    </div>
    <div class="pagination" id="paginationSearchOnePage" style="float: right">
    </div>
</div>
<script>
    var pageCofig = {
        pageSize: 2,
        pageIndex: 1
    }
    var pageSearchCofig = {
        pageSize: 2,
        pageIndex: 1
    }
    var pageSearchOneCofig = {
        pageSize: 1,
        pageIndex: 1
    }
    $(document).ready(function () {
        $("#pagination").hide();
        $("#paginationSearchMutiplePages").hide();
        $("#paginationSearchOnePage").hide();
        $("#tablePurchaseOrder").find('.dataTable').remove();
        $.ajax({
            type: "POST",
            url: "/Admin/PurchaseOrder/LoadData",
            data: '{page: ' + pageSearchCofig.pageIndex + ', pageSize: ' + pageSearchCofig.pageSize + ' }',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (response) {
                if (response.data.length > 0) {
                    var row = "";
                    for (var i = 0; i < response.data.length; i++) {
                        var date = new Date(parseInt(response.data[i].OrderDate.replace('/Date(', '')));
                        row += "<tr class='dataTable' id='" + response.data[i].Id + "'>" + "<td> <a onclick = importCar(" + response.data[i].Id + ") class='btn btn-primary' style = 'font-weight: bold; color: white'>Import</a> </td>" +"<td>" + response.data[i].PurchaseOrderId + "</td>" + "<td style = 'text-align: center'>" + response.data[i].QuantityCarImport + "</td>" + "<td>" + response.data[i].ModelCarName + "</td>" + "<td>" + convert(date) + "</td>" + "<td>" + (response.data[i].Status == 0 ? "Incomplete" : "Completed") + "</td>" + "<td> <a href='/Admin/PurchaseOrder/Details/" + response.data[i].Id + "' class='btn btn-info' style = 'font-weight: bold'>Details</a> <a href='/Admin/PurchaseOrder/Edit/" + response.data[i].Id + "' class='btn btn-success' style = 'font-weight: bold'>Edit</a> <a onclick = deletePurchaseOrder(" + response.data[i].Id + ") class='btn btn-danger' style = 'font-weight: bold; color: white'>Delete</a> </td>" + "</tr>"
                    }
                    $("#tablePurchaseOrder").append(row);
                    $("#pagination").show();
                    pagination(response.total, function () {
                    })
                }
            }
        });
    });

    $("#pagination").click(function () {
        loadData();
    });

    function loadData() {
        $("#tablePurchaseOrder").find('.dataTable').remove();
        $.ajax({
            type: "POST",
            url: "/Admin/PurchaseOrder/LoadData",
            data: '{page: ' + pageCofig.pageIndex + ', pageSize: ' + pageCofig.pageSize + ' }',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (response) {
                if (response.data.length > 0) {
                    var row = "";
                    for (var i = 0; i < response.data.length; i++) {
                        var date = new Date(parseInt(response.data[i].OrderDate.replace('/Date(', '')));
                        row += "<tr class='dataTable' id='" + response.data[i].Id + "'>" + "<td> <a onclick = importCar(" + response.data[i].Id + ") class='btn btn-primary' style = 'font-weight: bold; color: white'>Import</a> </td>"+ "<td>" + response.data[i].PurchaseOrderId + "</td>" + "<td style = 'text-align: center'>" + response.data[i].QuantityCarImport + "</td>" + "<td>" + response.data[i].ModelCarName + "</td>" + "<td>" + convert(date) + "</td>" + "<td>" + (response.data[i].Status == 0 ? "Incomplete" : "Completed") + "</td>" + "<td> <a href='/Admin/PurchaseOrder/Details/" + response.data[i].Id + "' class='btn btn-info' style = 'font-weight: bold'>Details</a> <a href='/Admin/PurchaseOrder/Edit/" + response.data[i].Id + "' class='btn btn-success' style = 'font-weight: bold'>Edit</a> <a onclick = deletePurchaseOrder(" + response.data[i].Id + ") class='btn btn-danger' style = 'font-weight: bold; color: white'>Delete</a> </td>" + "</tr>"
                    }
                    $("#tablePurchaseOrder").append(row);
                    $("#pagination").show();
                    pagination(response.total, function () {
                        loadData();
                    })
                }
            }
        });
    }

    function convert(str) {
        var date = new Date(str),
            month = ("0" + (date.getMonth() + 1)).slice(-2),
            day = ("0" + date.getDate()).slice(-2);
        return [month, day, date.getFullYear()].join("/");
    }

    function pagination(totalRow, callback) {
        var totalPage = Math.ceil(totalRow / pageCofig.pageSize);
        $('#pagination').twbsPagination({
            totalPages: totalPage,
            visiblePages: 10,
            onPageClick: function (event, page) {
                pageCofig.pageIndex = page;
                setTimeout(callback, 200);
            }
        });
    }

    function paginationSearchMutiplePages(totalRow, callback) {
        var totalPage = Math.ceil(totalRow / pageCofig.pageSize);
        $('#paginationSearchMutiplePages').twbsPagination({
            totalPages: totalPage,
            visiblePages: 10,
            onPageClick: function (event, page) {
                pageSearchCofig.pageIndex = page;
                setTimeout(callback, 500);
            }
        });
    }

    function paginationSearchOnePage(callback) {
        $('#paginationSearchOnePage').twbsPagination({
            totalPages: 1,
            visiblePages: 10,
            onPageClick: function (event, page) {
                pageSearchOneCofig.pageIndex = page;
                setTimeout(callback, 500);
            }
        });
    }
</script>

